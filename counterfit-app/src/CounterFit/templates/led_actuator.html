
<div class="card shadow-sm border-secondary" style="margin: 10px;">
    <div class="card-header py-3 text-white bg-secondary">
        <div class="container-fluid d-flex align-items-center">
            <h4 class="my-0 fw-normal">{{ actuator.actuator_name() }}</h4>
            <h4 class="my-0 fw-normal ms-auto">Pin {{actuator.port}}</h4>
        </div>
    </div>
    <div class="card-body">
        <div class="container">
            <div class="row">
                <div class="col">
                    <label for="color{{actuator.id}}">Color:</label>
                </div>
                <div class="col">
                    <input class="form-control" type="color" id="color{{actuator.id}}" value="{{actuator.color}}" style="width: 100%;"/>
                </div>
            </div>
            <div class="row" style="margin-top: 20px;">
                <div class="col">
                    
                </div>
                <div class="col">
                    <svg class="mx-auto d-block" width="48px" height="80px" viewBox="0 0 48 80" version="1.1" 
                         xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
                         role="img" aria-labelledby="ledTitleId{{actuator.id}}">
                        <title id="ledTitleId{{actuator.id}}">{% if actuator.value: %}LED on{% else %}LED off{% endif %}</title>
                        <g id="Symbols" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                            <g id="Artboard" transform="translate(0.000000, 2.000000)" fill-rule="nonzero">
                                <g id="LED" transform="translate(0.353000, -0.353000)">
                                    <rect id="Base" fill="#000000" x="0" y="43.445" width="46.86" height="8.059"></rect>
                                    <g id="Pins" transform="translate(6.209000, 47.009000)" fill="#000000">
                                        <rect id="Rectangle2" x="0" y="8.8817842e-15" width="6" height="30.557"></rect>
                                        <rect id="Rectangle1" x="28.442" y="8.8817842e-15" width="6" height="30.557"></rect>
                                    </g>
                                    <path d="M23.43,0 C11.844,0 2.452,9.392 2.452,20.978 L2.452,42.941 L44.407,42.941 L44.407,20.978 C44.408,9.392 35.016,0 23.43,0 Z M40.155,20.791 C40.126,21.09 40.098,21.383 40.071,21.668 C40.011,22.237 39.934,22.776 39.861,23.272 C39.723,24.266 39.553,25.094 39.423,25.673 C39.291,26.253 39.19,26.584 39.19,26.584 C39.19,26.584 39.087,26.253 38.957,25.673 C38.827,25.093 38.655,24.265 38.518,23.272 C38.445,22.775 38.368,22.237 38.308,21.668 C38.281,21.384 38.252,21.092 38.222,20.793 C38.174,20.511 38.141,20.225 38.1,19.934 C38.065,19.645 38.03,19.35 37.994,19.052 C37.952,18.756 37.864,18.462 37.811,18.163 C37.749,17.864 37.682,17.565 37.63,17.262 C37.57,16.96 37.455,16.671 37.372,16.373 L37.123,15.482 C37.025,15.191 36.906,14.908 36.8,14.623 C36.689,14.339 36.586,14.054 36.487,13.769 C36.369,13.495 36.228,13.234 36.11,12.966 C35.989,12.698 35.87,12.435 35.753,12.176 C35.635,11.918 35.477,11.69 35.353,11.448 C35.081,10.982 34.872,10.486 34.597,10.11 C34.332,9.719 34.107,9.335 33.899,8.989 C33.658,8.656 33.447,8.365 33.274,8.127 C32.93,7.642 32.753,7.345 32.753,7.345 C32.753,7.345 33.067,7.491 33.585,7.783 C33.84,7.933 34.163,8.097 34.501,8.331 C34.831,8.587 35.211,8.882 35.608,9.234 C36.037,9.566 36.391,9.996 36.795,10.444 C36.991,10.672 37.203,10.901 37.39,11.156 C37.565,11.42 37.743,11.689 37.924,11.963 C38.104,12.24 38.291,12.521 38.456,12.818 C38.604,13.123 38.754,13.434 38.896,13.751 C39.033,14.07 39.201,14.382 39.314,14.714 L39.625,15.727 C39.715,16.069 39.834,16.404 39.896,16.75 C39.958,17.097 40.002,17.445 40.053,17.79 C40.098,18.134 40.163,18.474 40.172,18.814 C40.173,19.153 40.174,19.49 40.175,19.82 C40.166,20.154 40.168,20.476 40.155,20.791 Z"
                                        stroke="#000000" stroke-width="2" fill="#FFFFFF">
                                    </path>
                                    <path id="led{{actuator.id}}" d="M23.43,0 C11.844,0 2.452,9.392 2.452,20.978 L2.452,42.941 L44.407,42.941 L44.407,20.978 C44.408,9.392 35.016,0 23.43,0 Z M40.155,20.791 C40.126,21.09 40.098,21.383 40.071,21.668 C40.011,22.237 39.934,22.776 39.861,23.272 C39.723,24.266 39.553,25.094 39.423,25.673 C39.291,26.253 39.19,26.584 39.19,26.584 C39.19,26.584 39.087,26.253 38.957,25.673 C38.827,25.093 38.655,24.265 38.518,23.272 C38.445,22.775 38.368,22.237 38.308,21.668 C38.281,21.384 38.252,21.092 38.222,20.793 C38.174,20.511 38.141,20.225 38.1,19.934 C38.065,19.645 38.03,19.35 37.994,19.052 C37.952,18.756 37.864,18.462 37.811,18.163 C37.749,17.864 37.682,17.565 37.63,17.262 C37.57,16.96 37.455,16.671 37.372,16.373 L37.123,15.482 C37.025,15.191 36.906,14.908 36.8,14.623 C36.689,14.339 36.586,14.054 36.487,13.769 C36.369,13.495 36.228,13.234 36.11,12.966 C35.989,12.698 35.87,12.435 35.753,12.176 C35.635,11.918 35.477,11.69 35.353,11.448 C35.081,10.982 34.872,10.486 34.597,10.11 C34.332,9.719 34.107,9.335 33.899,8.989 C33.658,8.656 33.447,8.365 33.274,8.127 C32.93,7.642 32.753,7.345 32.753,7.345 C32.753,7.345 33.067,7.491 33.585,7.783 C33.84,7.933 34.163,8.097 34.501,8.331 C34.831,8.587 35.211,8.882 35.608,9.234 C36.037,9.566 36.391,9.996 36.795,10.444 C36.991,10.672 37.203,10.901 37.39,11.156 C37.565,11.42 37.743,11.689 37.924,11.963 C38.104,12.24 38.291,12.521 38.456,12.818 C38.604,13.123 38.754,13.434 38.896,13.751 C39.033,14.07 39.201,14.382 39.314,14.714 L39.625,15.727 C39.715,16.069 39.834,16.404 39.896,16.75 C39.958,17.097 40.002,17.445 40.053,17.79 C40.098,18.134 40.163,18.474 40.172,18.814 C40.173,19.153 40.174,19.49 40.175,19.82 C40.166,20.154 40.168,20.476 40.155,20.791 Z"
                                        stroke="#000000" stroke-width="2" fill="{{actuator.color}}"
                                        {% if actuator.value: %}
                                            visibility="visible"
                                        {% else %}
                                            visibility="hidden"
                                        {% endif %}
                                        >
                                    </path>
                                </g>
                            </g>
                        </g>
                    </svg>
                </div>
            </div>
        </div>
    </div>
    <div class="card-footer">
        <div class="container">
            <div class="row">
                <div class="col">
                    <button id="actuator_set_button{{actuator.id}}" class="w-100 btn btn-lg btn-primary">Set</button>
                </div>
                <div class="col">
                    <button id="actuator_delete_button{{actuator.id}}" class="w-100 btn btn-lg btn-danger">Delete</button>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        window.addEventListener("DOMContentLoaded", function () {
            var set_button = document.getElementById("actuator_set_button{{actuator.id}}")
            var delete_button = document.getElementById("actuator_delete_button{{actuator.id}}")
            var color_control = document.getElementById("color{{actuator.id}}")
            var led_control = document.getElementById("led{{actuator.id}}")
            var led_title = document.getElementById("ledTitleId{{actuator.id}}")

            set_button.addEventListener("click", function() {
                // get the values
                var color = color_control.value

                var payload = {
                    "port": "{{actuator.id}}",
                    'color': color
                }

                var xhr = new XMLHttpRequest();
                var url = "./led_actuator_settings";
                xhr.open("POST", url, false);
                xhr.setRequestHeader("Content-Type", "application/json");
                var data = JSON.stringify(payload);
                xhr.send(data);

                led_control.style.fill=color
            });

            delete_button.addEventListener("click", function(){
                var payload = {
                    "port": "{{actuator.id}}"
                }

                var xhr = new XMLHttpRequest();
                var url = "./delete_actuator";
                xhr.open("POST", url, false);
                xhr.setRequestHeader("Content-Type", "application/json");
                var data = JSON.stringify(payload);
                xhr.send(data);
                location.reload();
            });

            var socket = io();
            socket.on('actuator_change{{actuator.id}}', function(data) {
                if (data.value){
                    led_control.style.visibility = "visible"
                    led_title.innerHTML = "LED on"
                } else {
                    led_control.style.visibility = "hidden"
                    led_title.innerHTML = "LED off"
                }

                console.log('actuator change received');
                console.log(data);
            });
        })
    </script>
</div>